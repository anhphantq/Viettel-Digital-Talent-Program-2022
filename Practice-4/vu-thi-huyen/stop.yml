---
- name: stop all container
  hosts: node_exporters

  tasks:
    - name: Get info on docker host and list images
      become: yes
      docker_host_info:
        containers: yes
      register: containers_to_stop

    - name: Stop running docker containers
      become: yes
      docker_container:
        name: '{{ item.Names.0[1:] }}'
        image: '{{ item.Image }}'
        state: stopped
      loop: '{{ containers_to_stop.containers }}'
